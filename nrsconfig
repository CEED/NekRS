#!/bin/bash
set -e -a

#########################################################################

: ${NEKRS_HOME:=${HOME}/.local/nekrs}
: ${NEKRS_CC:="mpicc"}
: ${NEKRS_CXX:="mpic++"}
: ${NEKRS_FC:="mpif77"}

#########################################################################

: ${NRSCONFIG_NOBUILD:=0}

cmake -S . -B build \
      -Wno-dev \
      -Wfatal-errors \
      -DCMAKE_INSTALL_PREFIX="${NEKRS_HOME}" \
      -DCMAKE_Fortran_COMPILER="${NEKRS_FC}" \
      -DCMAKE_C_COMPILER="${NEKRS_CC}" \
      -DCMAKE_CXX_COMPILER="${NEKRS_CXX}" \
      $@

if [ $? -eq 0 ] && [ ${NRSCONFIG_NOBUILD} -eq 0 ]; then
  cmd="cmake --build ./build --target install -j8 -v"
  echo ""        
  read -p "Hit enter to run: $cmd"
  $cmd
fi
